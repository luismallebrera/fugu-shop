/* NM: Quick-view script */
!function(n){"use strict";n.extend(n.nmTheme,{quickview_init:function(){var e,i=this,o=n("#fugu-quickview"),t=n('<div id="fugu-quickview-overlay" class="mfp-bg fugu-mfp-fade-in"></div>');"1"==fugu_wp_vars.quickviewLinks.link&&i.$body.on("click",".fugu-quickview-btn",(function(n){n.preventDefault(),a(this)})),"1"==fugu_wp_vars.quickviewLinks.thumb&&i.$body.on("click",".fugu-shop-loop-thumbnail-link",(function(n){n.preventDefault(),a(this)})),"1"==fugu_wp_vars.quickviewLinks.title&&i.$body.on("click",".fugu-shop-loop-title-link",(function(n){n.preventDefault(),a(this)}));var a=function(o){var a=n(o);(e=(e=a.data("product-id"))||a.closest(".product").data("product-id"))?(i.$html.css("width","auto"),t.appendTo(i.$body),t.addClass("show mfp-ready fugu-loader"),c()):console.log("NM: Error - _qvClick() - No product ID found")},c=function(){var a,c={product_id:e};"undefined"!=typeof wc_add_to_cart_params?a=wc_add_to_cart_params.wc_ajax_url.toString().replace("%%endpoint%%","fugu_ajax_load_product"):(a=fugu_wp_vars.ajaxUrl,c.action="fugu_ajax_load_product"),window.fugu_quickview_get_product=n.ajax({type:"POST",url:a,data:c,dataType:"html",cache:!1,headers:{"cache-control":"no-cache"},beforeSend:function(){"object"==typeof window.fugu_quickview_get_product&&window.fugu_quickview_get_product.abort()},error:function(n,e,o){console.log("NM: AJAX error - _qvLoadProduct() - "+o),i.$html.css("width",""),t.removeClass("mfp-ready mfp-removing").remove()},success:function(a){0===a.length&&(console.log("NM: AJAX - _qvLoadProduct() - Empty data"),i.$html.css("width",""),t.removeClass("mfp-ready mfp-removing").remove()),o.html(a);var c=o.children("#product-"+e),s=c.find("form.cart"),l=n("#fugu-quickview-slider").find("img"),d=l.last();l.removeAttr("loading"),d.one("load",(function(){c.hasClass("product-variable")&&(s.wc_variation_form().find(".variations select:eq(0)").trigger("change"),i.singleProductVariationsInit(s),s.on("woocommerce_variation_select_change",(function(){i.qvHasSlider&&i.$qvSlider.slick("slickGoTo",0,!1)}))),i.quantityInputsBindButtons(n("#fugu-qv-product-summary")),r()}))}})},r=function(){n.magnificPopup.open({mainClass:"fugu-mfp-quickview fugu-mfp-fade-in",closeMarkup:'<a class="mfp-close fugu-font fugu-font-close2"></a>',removalDelay:180,fixedContentPos:!0,items:{src:o,type:"inline"},callbacks:{open:function(){t.removeClass("fugu-loader"),s(),t.one("touchstart.qv",(function(){n.magnificPopup.close()})),i.$document.trigger("fugu_ajax_quickview_open",e)},beforeClose:function(){t.addClass("mfp-removing")},close:function(){i.$html.css("width",""),t.removeClass("mfp-ready mfp-removing").remove()}}})},s=function(){if(i.qvHasSlider=!1,i.$qvSlider=n("#fugu-quickview-slider"),i.$qvSlider.children().length>1){i.qvHasSlider=!0;var e="1"==fugu_wp_vars.quickViewGalleryInfinite;i.$qvSlider.slick({prevArrow:'<a class="slick-prev"><i class="fugu-font fugu-font-angle-thin-left"></i></a>',nextArrow:'<a class="slick-next"><i class="fugu-font fugu-font-angle-thin-right"></i></a>',dots:!1,infinite:e,speed:350})}}}}),n.nmThemeExtensions.quickview=n.nmTheme.quickview_init}(jQuery);