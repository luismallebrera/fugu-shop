/* NM: Add-to-cart script */
!function(t){"use strict";t.extend(t.nmTheme,{atc_init:function(){this.atcBind()},atcBind:function(){var o=this;o.$body.on("click",".single_add_to_cart_button",(function(a){var e=t(this);if(e.is(".disabled"))console.log("NM: Add-to-cart button disabled");else if(e.hasClass("fugu-simple-add-to-cart-button")||e.hasClass("fugu-variable-add-to-cart-button")){a.preventDefault(),e.attr("disabled","disabled"),o.quickviewOpen=o.quickviewIsOpen(),o.quickviewOpen&&setTimeout((function(){var o=t("#fugu-quickview");o.addClass("fade-out"),setTimeout((function(){t.magnificPopup.close(),setTimeout((function(){o.removeClass("fade-out")}),200)}),200)}),200);var n=e.closest("form");if(!n.length)return;var r={product_id:n.find("[name*='add-to-cart']").val(),product_variation_data:n.serialize()};o.$body.trigger("adding_to_cart",[e,r]),o.atcAjaxSubmitForm(e,r)}}))},atcAjaxSubmitForm:function(o,a){var e=this;if(a.product_id){if("undefined"!=typeof wc_add_to_cart_params)var n=wc_add_to_cart_params.wc_ajax_url;else{console.log('NM: "wc_add_to_cart_params" undefined - WooCommerce AJAX atc disabled');n=fugu_wp_vars.woocommerceAjaxUrl}n=n.toString().replace("wc-ajax=%%endpoint%%","add-to-cart="+a.product_id+"&fugu-ajax-add-to-cart=1"),t.ajax({type:"POST",url:n,data:a.product_variation_data,dataType:"html",cache:!1,headers:{"cache-control":"no-cache"},error:function(t,o,a){console.log("NM: AJAX error - atcAjaxSubmitForm() - "+a)},success:function(a){var n=t("<div>"+a+"</div>"),r=n.find("#fugu-shop-notices-wrap"),i=!!r.find(".woocommerce-error").length,c={".fugu-menu-cart-count":n.find(".fugu-menu-cart-count").prop("outerHTML"),"#fugu-shop-notices-wrap":r.prop("outerHTML"),".widget_shopping_cart_content":n.find(".widget_shopping_cart_content").prop("outerHTML")};e.shopReplaceFragments(c),e.$body.trigger("added_to_cart",[c,"",o]),e.quickviewOpen?i&&(e.$cartPanel.length&&e.cartPanelHide(),e.isShop&&e.shopScrollToTop()):(o.removeAttr("disabled"),i&&setTimeout((function(){t("#fugu-cart-panel-overlay").trigger("click"),e.isShop&&e.shopScrollToTop()}),500)),n.empty()}})}else console.log("NM (Error): No product id found")}}),t.nmThemeExtensions.add_to_cart=t.nmTheme.atc_init}(jQuery);